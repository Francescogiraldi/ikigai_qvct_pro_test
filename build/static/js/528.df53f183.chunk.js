(self.webpackChunkikigai_app_new=self.webpackChunkikigai_app_new||[]).push([[528],{2285:(e,t,n)=>{var s=n(2285);function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}var a=i,r=o;function c(e){if(a===setTimeout)return setTimeout(e,0);if((a===i||!a)&&setTimeout)return a=setTimeout,setTimeout(e,0);try{return a(e,0)}catch(t){try{return a.call(null,e,0)}catch(t){return a.call(this,e,0)}}}"function"===typeof n.g.setTimeout&&(a=setTimeout),"function"===typeof n.g.clearTimeout&&(r=clearTimeout);var l,u=[],d=!1,p=-1;function h(){d&&l&&(d=!1,l.length?u=l.concat(u):p=-1,u.length&&f())}function f(){if(!d){var e=c(h);d=!0;for(var t=u.length;t;){for(l=u,u=[];++p<t;)l&&l[p].run();p=-1,t=u.length}l=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function g(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new _(e,t)),1!==u.length||d||c(f)},_.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_SUPABASE_URL:"https://mgegwthaogszzgflwery.supabase.co",REACT_APP_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nZWd3dGhhb2dzenpnZmx3ZXJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxMjUyMjIsImV4cCI6MjA1OTcwMTIyMn0.ojqRmmC1O4sFTJDydtdSQ15J5ywMyCNBAkMYAkqYQxM",REACT_APP_AUTH_PROVIDERS:"email,google",REACT_APP_AUTH_REDIRECT_URL:"http://localhost:3000",REACT_APP_STORAGE_TYPE:"supabase"}={}),s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0},e.exports=s},8528:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Client:()=>me,FileData:()=>W,client:()=>we,duplicate:()=>ye,handle_file:()=>Y,predict:()=>te,prepare_files:()=>J,submit:()=>ge,upload:()=>F,upload_files:()=>B});var s,i=n(2285),o=n(6382).Buffer,a=Object.defineProperty,r=(e,t,n)=>(((e,t,n)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n),c=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},l=(e,t,n)=>(c(e,t,"read from private field"),n?n.call(e):t.get(e)),u=new Intl.Collator(0,{numeric:1}).compare;function d(e,t,n){return e=e.split("."),t=t.split("."),u(e[0],t[0])||u(e[1],t[1])||(t[2]=t.slice(2).join("."),(n=/[.-]/.test(e[2]=e.slice(2).join(".")))==/[.-]/.test(t[2])?u(e[2],t[2]):n?-1:1)}const p="host",h="queue/data",f="queue/join",_="upload",g="config",m="reset",w="cancel",y="This application is currently busy. Please try again. ",v="Connection errored out. ",b="Could not resolve app config. ",E="Space metadata could not be loaded. ",S="Invalid credentials. Could not login. ",k="Root URL not found in client config";function $(e,t,n){return t.startsWith("http://")||t.startsWith("https://")?n?e:t:e+t}async function x(e,t,n){try{const s=await fetch(`https://huggingface.co/api/spaces/${e}/jwt`,{headers:{Authorization:`Bearer ${t}`,...n?{Cookie:n}:{}}});return(await s.json()).token||!1}catch(s){return!1}}async function T(e){var t;const n=this.options.hf_token?{Authorization:`Bearer ${this.options.hf_token}`}:{};if(n["Content-Type"]="application/json","undefined"!==typeof window&&window.gradio_config&&"http://localhost:9876"!==location.origin&&!window.gradio_config.dev_mode){const t=window.gradio_config.root,n=window.gradio_config;let s=$(e,n.root,!1);return n.root=s,{...n,path:t}}if(e){let s=q(e,this.deep_link?g+"?deep_link="+this.deep_link:g);const i=await this.fetch(s,{headers:n,credentials:"include"});if(401===(null==i?void 0:i.status)&&!this.options.auth)throw new Error("Login credentials are required to access this space.");if(401===(null==i?void 0:i.status)&&this.options.auth)throw new Error(S);if(200===(null==i?void 0:i.status)){let n=await i.json();return n.path=n.path??"",n.root=e,null==(t=n.dependencies)||t.forEach(((e,t)=>{void 0===e.id&&(e.id=t)})),n}if(401===(null==i?void 0:i.status))throw new Error("Not authorized to access this space. ");throw new Error(b)}throw new Error(b)}async function C(){const{http_protocol:e,host:t}=await N(this.app_reference,this.options.hf_token);try{if(this.options.auth){const n=await O(e,t,this.options.auth,this.fetch,this.options.hf_token);n&&this.set_cookies(n)}}catch(n){throw Error(n.message)}}async function O(e,t,n,s,i){const o=new FormData;o.append("username",null==n?void 0:n[0]),o.append("password",null==n?void 0:n[1]);let a={};i&&(a.Authorization=`Bearer ${i}`);const r=await s(`${e}//${t}/login`,{headers:a,method:"POST",body:o,credentials:"include"});if(200===r.status)return r.headers.get("set-cookie");throw 401===r.status?new Error(S):new Error(E)}function P(e){if(e.startsWith("http")){const{protocol:t,host:n,pathname:s}=new URL(e);return{ws_protocol:"https:"===t?"wss":"ws",http_protocol:t,host:n+("/"!==s?s:"")}}return e.startsWith("file:")?{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"}:{ws_protocol:"wss",http_protocol:"https:",host:new URL(e).host}}const A=e=>{let t=[];return e.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach((e=>{const[n,s]=e.split(";")[0].split("=");n&&s&&t.push(`${n.trim()}=${s.trim()}`)})),t},j=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,D=/.*hf\.space\/{0,1}.*$/;async function N(e,t){const n={};t&&(n.Authorization=`Bearer ${t}`);const s=e.trim().replace(/\/$/,"");if(j.test(s))try{const t=await fetch(`https://huggingface.co/api/spaces/${s}/${p}`,{headers:n});return{space_id:e,...P((await t.json()).host)}}catch(i){throw new Error(E)}if(D.test(s)){const{ws_protocol:e,http_protocol:t,host:n}=P(s);return{space_id:n.split("/")[0].replace(".hf.space",""),ws_protocol:e,http_protocol:t,host:n}}return{space_id:!1,...P(s)}}const q=function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>(e=e.replace(/\/+$/,""),t=t.replace(/^\/+/,""),new URL(t,e+"/").toString())))}catch(s){throw new Error("Invalid URL. A full URL path is required.")}};function z(e,t,n,s){if("Api"===t)return e.type;switch(null==e?void 0:e.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}return"JSONSerializable"===n||"StringSerializable"===n?"any":"ListStringSerializable"===n?"string[]":"Image"===t?"parameter"===s?"Blob | File | Buffer":"string":"FileSerializable"===n?"array"===(null==e?void 0:e.type)?"parameter"===s?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":"parameter"===s?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}":"GallerySerializable"===n?"parameter"===s?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]":void 0}function I(e,t){return"GallerySerializable"===t?"array of [file, label] tuples":"ListStringSerializable"===t?"array of strings":"FileSerializable"===t?"array of files or single file":null==e?void 0:e.description}function R(e,t){const n=!0;switch(e.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:n,message:y,stage:"error",code:e.code,success:e.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:n,message:e.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:n,stage:t||"pending",code:e.code,size:e.queue_size,position:e.rank,eta:e.rank_eta,success:e.success}};case"progress":return{type:"update",status:{queue:n,stage:"pending",code:e.code,progress_data:e.progress_data,success:e.success}};case"log":return{type:"log",data:e};case"process_generating":return{type:"generating",status:{queue:n,message:e.success?null:e.output.error,stage:e.success?"generating":"error",code:e.code,progress_data:e.progress_data,eta:e.average_duration,changed_state_ids:e.success?e.output.changed_state_ids:void 0},data:e.success?e.output:null};case"process_streaming":return{type:"streaming",status:{queue:n,message:e.output.error,stage:"streaming",time_limit:e.time_limit,code:e.code,progress_data:e.progress_data,eta:e.eta},data:e.output};case"process_completed":return"error"in e.output?{type:"update",status:{queue:n,title:e.output.title,message:e.output.error,visible:e.output.visible,duration:e.output.duration,stage:"error",code:e.code,success:e.success}}:{type:"complete",status:{queue:n,message:e.success?void 0:e.output.error,stage:e.success?"complete":"error",code:e.code,progress_data:e.progress_data,changed_state_ids:e.success?e.output.changed_state_ids:void 0},data:e.success?e.output:null};case"process_starts":return{type:"update",status:{queue:n,stage:"pending",code:e.code,size:e.rank,position:0,success:e.success,eta:e.eta},original_msg:"process_starts"}}return{type:"none",status:{stage:"error",queue:n}}}const L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=t?t.parameters:[];if(Array.isArray(e))return e.length>n.length&&console.warn("Too many arguments provided for the endpoint."),e;const s=[],i=Object.keys(e);return n.forEach(((t,n)=>{if(e.hasOwnProperty(t.parameter_name))s[n]=e[t.parameter_name];else{if(!t.parameter_has_default)throw new Error(`No value provided for required parameter: ${t.parameter_name}`);s[n]=t.parameter_default}})),i.forEach((e=>{if(!n.some((t=>t.parameter_name===e)))throw new Error(`Parameter \`${e}\` is not a valid keyword argument. Please refer to the API for usage.`)})),s.forEach(((e,t)=>{if(void 0===e&&!n[t].parameter_has_default)throw new Error(`No value provided for required parameter: ${n[t].parameter_name}`)})),s};async function U(){if(this.api_info)return this.api_info;const{hf_token:e}=this.options,{config:t}=this,n={"Content-Type":"application/json"};if(e&&(n.Authorization=`Bearer ${e}`),t)try{let e,s;if("undefined"!==typeof window&&window.gradio_api_info)s=window.gradio_api_info;else{if(d((null==t?void 0:t.version)||"2.0.0","3.30")<0)e=await this.fetch("https://gradio-space-api-fetcher-v2.hf.space/api",{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(t)}),headers:n,credentials:"include"});else{const s=q(t.root,this.api_prefix,"info");e=await this.fetch(s,{headers:n,credentials:"include"})}if(!e.ok)throw new Error(v);s=await e.json()}return"api"in s&&(s=s.api),s.named_endpoints["/predict"]&&!s.unnamed_endpoints[0]&&(s.unnamed_endpoints[0]=s.named_endpoints["/predict"]),function(e,t,n){const s={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(e).forEach((i=>{"named_endpoints"!==i&&"unnamed_endpoints"!==i||(s[i]={},Object.entries(e[i]).forEach((e=>{let[o,{parameters:a,returns:r}]=e;var c,l,u,d;const p=(null==(c=t.dependencies.find((e=>e.api_name===o||e.api_name===o.replace("/",""))))?void 0:c.id)||n[o.replace("/","")]||-1,h=-1!==p?null==(l=t.dependencies.find((e=>e.id==p)))?void 0:l.types:{generator:!1,cancel:!1};if(-1!==p&&(null==(d=null==(u=t.dependencies.find((e=>e.id==p)))?void 0:u.inputs)?void 0:d.length)!==a.length){const e=t.dependencies.find((e=>e.id==p)).inputs.map((e=>{var n;return null==(n=t.components.find((t=>t.id===e)))?void 0:n.type}));try{e.forEach(((e,t)=>{if("state"===e){const e={component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0};a.splice(t,0,e)}}))}catch(_){console.error(_)}}const f=(e,t,n,s)=>({...e,description:I(null==e?void 0:e.type,n),type:z(null==e?void 0:e.type,t,n,s)||""});s[i][o]={parameters:a.map((e=>f(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"parameter"))),returns:r.map((e=>f(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"return"))),type:h}})))})),s}(s,t,this.api_map)}catch(s){throw new Error("Could not get API info. "+s.message)}}async function B(e,t,n){var s;const i={};(null==(s=null==this?void 0:this.options)?void 0:s.hf_token)&&(i.Authorization=`Bearer ${this.options.hf_token}`);const o=[];let a;for(let c=0;c<t.length;c+=1e3){const s=t.slice(c,c+1e3),l=new FormData;s.forEach((e=>{l.append("files",e)}));try{const t=n?`${e}${this.api_prefix}/${_}?upload_id=${n}`:`${e}${this.api_prefix}/${_}`;a=await this.fetch(t,{method:"POST",body:l,headers:i,credentials:"include"})}catch(r){throw new Error(v+r.message)}if(!a.ok){const e=await a.text();return{error:`HTTP ${a.status}: ${e}`}}const u=await a.json();u&&o.push(...u)}return{files:o}}async function F(e,t,n,s){let i=(Array.isArray(e)?e:[e]).map((e=>e.blob));const o=i.filter((e=>e.size>(s??1/0)));if(o.length)throw new Error(`File size exceeds the maximum allowed size of ${s} bytes: ${o.map((e=>e.name)).join(", ")}`);return await Promise.all(await this.upload_files(t,i,n).then((async n=>{if(n.error)throw new Error(n.error);return n.files?n.files.map(((n,s)=>new W({...e[s],path:n,url:`${t}${this.api_prefix}/file=${n}`}))):[]})))}async function J(e,t){return e.map((e=>new W({path:e.name,orig_name:e.name,blob:e,size:e.size,mime_type:e.type,is_stream:t})))}class W{constructor(e){let{path:t,url:n,orig_name:s,size:i,blob:o,is_stream:a,mime_type:c,alt_text:l,b64:u}=e;r(this,"path"),r(this,"url"),r(this,"orig_name"),r(this,"size"),r(this,"blob"),r(this,"is_stream"),r(this,"mime_type"),r(this,"alt_text"),r(this,"b64"),r(this,"meta",{_type:"gradio.FileData"}),this.path=t,this.url=n,this.orig_name=s,this.size=i,this.blob=n?void 0:o,this.is_stream=a,this.mime_type=c,this.alt_text=l,this.b64=u}}class M{constructor(e,t){r(this,"type"),r(this,"command"),r(this,"meta"),r(this,"fileData"),this.type="command",this.command=e,this.meta=t}}const G="undefined"!==typeof i&&i.versions&&i.versions.node;function H(e,t,n){for(;n.length>1;){const t=n.shift();if("string"!==typeof t&&"number"!==typeof t)throw new Error("Invalid key type");e=e[t]}const s=n.shift();if("string"!==typeof s&&"number"!==typeof s)throw new Error("Invalid key type");e[s]=t}async function Z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;if(Array.isArray(e)){let o=[];return await Promise.all(e.map((async(a,r)=>{var c;let l=n.slice();l.push(String(r));const u=await Z(e[r],s?(null==(c=null==i?void 0:i.parameters[r])?void 0:c.component)||void 0:t,l,!1,i);o=o.concat(u)}))),o}if(globalThis.Buffer&&e instanceof globalThis.Buffer||e instanceof Blob)return[{path:n,blob:new Blob([e]),type:t}];if("object"===typeof e&&null!==e){let t=[];for(const s of Object.keys(e)){const o=[...n,s],a=e[s];t=t.concat(await Z(a,void 0,o,!1,i))}return t}return[]}function Y(e){if("string"===typeof e){if(e.startsWith("http://")||e.startsWith("https://"))return{path:e,url:e,orig_name:e.split("/").pop()??"unknown",meta:{_type:"gradio.FileData"}};if(G)return new M("upload_file",{path:e,name:e,orig_path:e})}else{if("undefined"!==typeof File&&e instanceof File)return new Blob([e]);if(e instanceof o)return new Blob([e]);if(e instanceof Blob)return e}throw new Error("Invalid input: must be a URL, File, Blob, or Buffer object.")}function K(e,t,n,s){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("input"===s&&!i)throw new Error("Invalid code path. Cannot skip state inputs for input.");if("output"===s&&i)return e;let o=[],a=0;const r="input"===s?t.inputs:t.outputs;for(let c=0;c<r.length;c++){const t=r[c],s=n.find((e=>e.id===t));if("state"!==(null==s?void 0:s.type)){const t=e[a];o.push(t),a++}else{if(!i){a++;continue}if(e.length===r.length){const t=e[a];o.push(t),a++}else o.push(null)}}return o}async function V(e,t,n){const s=this;await async function(e,t){var n,s;if(!(null==(n=e.config)?void 0:n.root)&&!(null==(s=e.config)?void 0:s.root_url))throw new Error(k);await Q(e,t)}(s,t);const i=await Z(t,void 0,[],!0,n);return(await Promise.all(i.map((async t=>{let{path:n,blob:i,type:o}=t;if(!i)return{path:n,type:o};const a=await s.upload_files(e,[i]);return{path:n,file_url:a.files&&a.files[0],type:o,name:"undefined"!==typeof File&&i instanceof File?null==i?void 0:i.name:void 0}})))).forEach((e=>{let{path:n,file_url:s,type:i,name:o}=e;if("Gallery"===i)H(t,s,n);else if(s){const e=new W({path:s,orig_name:o});H(t,e,n)}})),t}async function Q(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(const s in t)t[s]instanceof M?await X(e,t,s):"object"===typeof t[s]&&null!==t[s]&&await Q(e,t[s],[...n,s])}async function X(e,t,s){var o,a;let r=t[s];const c=(null==(o=e.config)?void 0:o.root)||(null==(a=e.config)?void 0:a.root_url);if(!c)throw new Error(k);try{let o,a;if("undefined"===typeof i||!i.versions||!i.versions.node)throw new Error("File system access is only available in Node.js environments");{const e=await n.e(584).then(n.t.bind(n,4584,19));a=(await n.e(316).then(n.t.bind(n,3316,19))).resolve(i.cwd(),r.meta.path),o=await e.readFile(a)}const l=new Blob([o],{type:"application/octet-stream"}),u=await e.upload_files(c,[l]),d=u.files&&u.files[0];if(d){const e=new W({path:d,orig_name:r.meta.name||""});t[s]=e}}catch(l){console.error("Error uploading file",l)}}async function ee(e,t,n){const s={"Content-Type":"application/json"};this.options.hf_token&&(s.Authorization=`Bearer ${this.options.hf_token}`);try{var i=await this.fetch(e,{method:"POST",body:JSON.stringify(t),headers:{...s,...n},credentials:"include"})}catch(r){return[{error:v},500]}let o,a;try{o=await i.json(),a=i.status}catch(r){o={error:`Could not parse server response: ${r}`},a=500}return[o,a]}async function te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!1,s=!1;if(!this.config)throw new Error("Could not resolve app config");if("number"===typeof e)this.config.dependencies.find((t=>t.id==e));else{const t=e.replace(/^\//,"");this.config.dependencies.find((e=>e.id==this.api_map[t]))}return new Promise((async(i,o)=>{const a=this.submit(e,t,null,null,!0);let r;for await(const e of a)"data"===e.type&&(s&&i(r),n=!0,r=e),"status"===e.type&&("error"===e.stage&&o(e),"complete"===e.stage&&(s=!0,n&&i(r)))}))}async function ne(e,t,n){let s,i,o="subdomain"===t?`https://huggingface.co/api/spaces/by-subdomain/${e}`:`https://huggingface.co/api/spaces/${e}`;try{if(s=await fetch(o),i=s.status,200!==i)throw new Error;s=await s.json()}catch(c){return void n({status:"error",load_status:"error",message:"Could not get space status. ",detail:"NOT_FOUND"})}if(!s||200!==i)return;const{runtime:{stage:a},id:r}=s;switch(a){case"STOPPED":case"SLEEPING":n({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:a}),setTimeout((()=>{ne(e,t,n)}),1e3);break;case"PAUSED":n({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:a,discussions_enabled:await oe(r)});break;case"RUNNING":case"RUNNING_BUILDING":n({status:"running",load_status:"complete",message:"Space is running.",detail:a});break;case"BUILDING":n({status:"building",load_status:"pending",message:"Space is building...",detail:a}),setTimeout((()=>{ne(e,t,n)}),1e3);break;case"APP_STARTING":n({status:"starting",load_status:"pending",message:"Space is starting...",detail:a}),setTimeout((()=>{ne(e,t,n)}),1e3);break;default:n({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:a,discussions_enabled:await oe(r)})}}const se=async(e,t)=>{let n=0;return new Promise((s=>{ne(e,j.test(e)?"space_name":"subdomain",(i=>{t(i),"running"===i.status||"error"===i.status||"paused"===i.status||"space_error"===i.status?s():"sleeping"!==i.status&&"building"!==i.status||(n<12?(n++,setTimeout((()=>{se(e,t).then(s)}),5e3)):s())}))}))},ie=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function oe(e){try{const t=await fetch(`https://huggingface.co/api/spaces/${e}/discussions`,{method:"HEAD"}),n=t.headers.get("x-error-message");return!(!t.ok||n&&ie.test(n))}catch(t){return!1}}const ae=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function re(e,t){const{hf_token:n,private:s,hardware:i,timeout:o,auth:a}=t;if(i&&!ae.includes(i))throw new Error(`Invalid hardware type provided. Valid types are: ${ae.map((e=>`"${e}"`)).join(",")}.`);const{http_protocol:r,host:c}=await N(e,n);let l=null;if(a){const e=await O(r,c,a,fetch);e&&(l=A(e))}const u={Authorization:`Bearer ${n}`,"Content-Type":"application/json",...l?{Cookie:l.join("; ")}:{}},d=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:u})).json()).name,p=e.split("/")[1],h={repository:`${d}/${p}`};let f;s&&(h.private=!0);try{i||(f=await async function(e,t){const n={};t&&(n.Authorization=`Bearer ${t}`);try{const t=await fetch(`https://huggingface.co/api/spaces/${e}/runtime`,{headers:n});if(200!==t.status)throw new Error("Space hardware could not be obtained.");const{hardware:s}=await t.json();return s.current}catch(s){throw new Error(s.message)}}(e,n))}catch(g){throw Error(E+g.message)}const _=i||f||"cpu-basic";h.hardware=_;try{const s=await fetch(`https://huggingface.co/api/spaces/${e}/duplicate`,{method:"POST",headers:u,body:JSON.stringify(h)});if(409===s.status)try{return await me.connect(`${d}/${p}`,t)}catch(m){throw console.error("Failed to connect Client instance:",m),m}else if(200!==s.status)throw new Error(s.statusText);const i=await s.json();return await async function(e,t,n){const s={};n&&(s.Authorization=`Bearer ${n}`);const i={seconds:t};try{const t=await fetch(`https://huggingface.co/api/spaces/${e}/sleeptime`,{method:"POST",headers:{"Content-Type":"application/json",...s},body:JSON.stringify(i)});if(200!==t.status)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await t.json()}catch(g){throw new Error(g.message)}}(`${d}/${p}`,o||300,n),await me.connect(function(e){const t=/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/,n=e.match(t);if(n)return n[1]}(i.url),t)}catch(g){throw new Error(g)}}class ce extends TransformStream{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{allowCR:!1};super({transform:(t,n)=>{for(t=l(this,s)+t;;){const s=t.indexOf("\n"),i=e.allowCR?t.indexOf("\r"):-1;if(-1!==i&&i!==t.length-1&&(-1===s||s-1>i)){n.enqueue(t.slice(0,i)),t=t.slice(i+1);continue}if(-1===s)break;const o="\r"===t[s-1]?s-1:s;n.enqueue(t.slice(0,o)),t=t.slice(s+1)}var i,o,a,r;a=t,c(i=this,o=s,"write to private field"),r?r.call(i,a):o.set(i,a)},flush:t=>{if(""===l(this,s))return;const n=e.allowCR&&l(this,s).endsWith("\r")?l(this,s).slice(0,-1):l(this,s);t.enqueue(n)}}),((e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)})(this,s,"")}}function le(e){let t=/[:]\s*/.exec(e),n=t&&t.index;if(n)return[e.substring(0,n),e.substring(n+t[0].length)]}function ue(e,t,n){e.get(t)||e.set(t,n)}async function*de(e,t){if(!e.body)return;let n,s,i=function(e){let t=new TextDecoderStream,n=new ce({allowCR:!0});return e.pipeThrough(t).pipeThrough(n)}(e.body).getReader();for(;;){if(t&&t.aborted)return i.cancel();if(n=await i.read(),n.done)return;if(!n.value){s&&(yield s),s=void 0;continue}let[e,o]=le(n.value)||[];e&&("data"===e?(s||(s={}),s[e]=s[e]?s[e]+"\n"+o:o):"event"===e?(s||(s={}),s[e]=o):"id"===e?(s||(s={}),s[e]=+o||o):"retry"===e&&(s||(s={}),s[e]=+o||void 0))}}async function pe(){let{event_callbacks:e,unclosed_events:t,pending_stream_messages:n,stream_status:s,config:i,jwt:o}=this;const a=this;if(!i)throw new Error("Could not resolve app config");s.open=!0;let r=null,c=new URLSearchParams({session_hash:this.session_hash}).toString(),l=new URL(`${i.root}${this.api_prefix}/${h}?${c}`);o&&l.searchParams.set("__sign",o),r=this.stream(l),r?(r.onmessage=async function(o){let r=JSON.parse(o.data);if("close_stream"===r.msg)return void he(s,a.abort_controller);const c=r.event_id;if(c)if(e[c]&&i){"process_completed"===r.msg&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(i.protocol)&&t.delete(c);let n=e[c];"undefined"!==typeof window&&"undefined"!==typeof document?setTimeout(n,0,r):n(r)}else n[c]||(n[c]=[]),n[c].push(r);else await Promise.all(Object.keys(e).map((t=>e[t](r))))},r.onerror=async function(){await Promise.all(Object.keys(e).map((t=>e[t]({msg:"unexpected_error",message:v}))))}):console.warn("Cannot connect to SSE endpoint: "+l.toString())}function he(e,t){e&&(e.open=!1,null==t||t.abort())}function fe(e,t,n){!e[t]?(e[t]=[],n.data.forEach(((n,s)=>{e[t][s]=n}))):n.data.forEach(((s,i)=>{let o=(a=e[t][i],s.forEach((e=>{let[t,n,s]=e;a=function(e,t,n,s){if(0===t.length){if("replace"===n)return s;if("append"===n)return e+s;throw new Error(`Unsupported action: ${n}`)}let i=e;for(let a=0;a<t.length-1;a++)i=i[t[a]];const o=t[t.length-1];switch(n){case"replace":i[o]=s;break;case"append":i[o]+=s;break;case"add":Array.isArray(i)?i.splice(Number(o),0,s):i[o]=s;break;case"delete":Array.isArray(i)?i.splice(Number(o),1):delete i[o];break;default:throw new Error(`Unknown action: ${n}`)}return e}(a,n,t,s)})),a);var a;e[t][i]=o,n.data[i]=o}))}function _e(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={close:()=>{console.warn("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:e.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:()=>{throw new Error("Method not implemented.")},dispatchEvent:()=>{throw new Error("Method not implemented.")},removeEventListener:()=>{throw new Error("Method not implemented.")}};return async function(e,t){let n=new Request(e,t);ue(n.headers,"Accept","text/event-stream"),ue(n.headers,"Content-Type","application/json");let s=await fetch(n);if(!s.ok)throw s;return de(s,n.signal)}(e,t).then((async e=>{n.readyState=n.OPEN;try{for await(const t of e)n.onmessage&&n.onmessage(t);n.readyState=n.CLOSED}catch(t){n.onerror&&n.onerror(t),n.readyState=n.CLOSED}})).catch((e=>{console.error(e),n.onerror&&n.onerror(e),n.readyState=n.CLOSED})),n}function ge(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;var o;try{let r=function(e){(i||ne[e.type])&&p(e)},c=function(){for(ae=!0;ce.length>0;)ce.shift()({value:void 0,done:!0})},l=function(e){ae||(ce.length>0?ce.shift()(e):re.push(e))},u=function(e){l(function(e){return{then:(t,n)=>n(e)}}(e)),c()},p=function(e){l({value:e,done:!1})},_=function(){return re.length>0?Promise.resolve(re.shift()):ae?Promise.resolve({value:void 0,done:!0}):new Promise((e=>ce.push(e)))};const{hf_token:g}=this.options,{fetch:b,app_reference:E,config:S,session_hash:k,api_info:x,api_map:T,stream_status:C,pending_stream_messages:O,pending_diff_streams:P,event_callbacks:A,unclosed_events:j,post_data:D,options:q,api_prefix:z}=this,I=this;if(!x)throw new Error("No API found");if(!S)throw new Error("Could not resolve app config");let U,B,{fn_index:F,endpoint_info:J,dependency:W}=function(e,t,n,s){let i,o,a;if("number"===typeof t)i=t,o=e.unnamed_endpoints[i],a=s.dependencies.find((e=>e.id==t));else{const r=t.replace(/^\//,"");i=n[r],o=e.named_endpoints[t.trim()],a=s.dependencies.find((e=>e.id==n[r]))}if("number"!==typeof i)throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:i,endpoint_info:o,dependency:a}}(x,e,T,S),M=L(t,J),G=S.protocol??"ws",H="",Z=()=>H;const Y="number"===typeof e?"/predict":e;let V,Q=null,X=!1,ee={},te="undefined"!==typeof window&&"undefined"!==typeof document?new URLSearchParams(window.location.search).toString():"";const ne=(null==(o=null==q?void 0:q.events)?void 0:o.reduce(((e,t)=>(e[t]=!0,e)),{}))||{};async function se(){const e={stage:"complete",queue:!1,time:new Date};X=e,r({...e,type:"status",endpoint:Y,fn_index:F});let t={},n={};"ws"===G?(U&&0===U.readyState?U.addEventListener("open",(()=>{U.close()})):U.close(),t={fn_index:F,session_hash:k}):(he(C,I.abort_controller),c(),t={event_id:Q},n={event_id:Q,session_hash:k,fn_index:F});try{if(!S)throw new Error("Could not resolve app config");"event_id"in n&&await b(`${S.root}${z}/${w}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)}),await b(`${S.root}${z}/${m}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)})}catch(s){console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}const ie=async e=>{await this._resolve_hearbeat(e)};async function oe(e){if(!S)return;let t=e.render_id;S.components=[...S.components.filter((e=>e.props.rendered_in!==t)),...e.components],S.dependencies=[...S.dependencies.filter((e=>e.rendered_in!==t)),...e.dependencies];const n=S.components.some((e=>"state"===e.type)),s=S.dependencies.some((e=>e.targets.some((e=>"unload"===e[1]))));S.connect_heartbeat=n||s,await ie(S),r({type:"render",data:e,endpoint:Y,fn_index:F})}this.handle_blob(S.root,M,J).then((async e=>{var t;let i=K(e,W,S.components,"input",!0);if(V={data:i||[],event_data:n,fn_index:F,trigger_id:s},function(e,t){var n,s;let i=null==(s=null==(n=null==t?void 0:t.dependencies)?void 0:n.find((t=>t.id==e)))?void 0:s.queue;return null!=i?!i:!t.enable_queue}(F,S))r({type:"status",endpoint:Y,stage:"pending",queue:!1,fn_index:F,time:new Date}),D(`${S.root}${z}/run${Y.startsWith("/")?Y:`/${Y}`}${te?"?"+te:""}`,{...V,session_hash:k}).then((e=>{let[t,i]=e;const o=t.data;200==i?(r({type:"data",endpoint:Y,fn_index:F,data:K(o,W,S.components,"output",q.with_null_state),time:new Date,event_data:n,trigger_id:s}),t.render_config&&oe(t.render_config),r({type:"status",endpoint:Y,fn_index:F,stage:"complete",eta:t.average_duration,queue:!1,time:new Date})):r({type:"status",stage:"error",endpoint:Y,fn_index:F,message:t.error,queue:!1,time:new Date})})).catch((e=>{r({type:"status",stage:"error",message:e.message,endpoint:Y,fn_index:F,queue:!1,time:new Date})}));else if("ws"==G){const{ws_protocol:e,host:t}=await N(E,g);r({type:"status",stage:"pending",queue:!0,endpoint:Y,fn_index:F,time:new Date});let i=new URL(`${e}://${$(t,S.path,!0)}/queue/join${te?"?"+te:""}`);this.jwt&&i.searchParams.set("__sign",this.jwt),U=new WebSocket(i),U.onclose=e=>{e.wasClean||r({type:"status",stage:"error",broken:!0,message:v,queue:!0,endpoint:Y,fn_index:F,time:new Date})},U.onmessage=function(e){const t=JSON.parse(e.data),{type:i,status:o,data:a}=R(t,ee[F]);if("update"===i&&o&&!X)r({type:"status",endpoint:Y,fn_index:F,time:new Date,...o}),"error"===o.stage&&U.close();else{if("hash"===i)return void U.send(JSON.stringify({fn_index:F,session_hash:k}));"data"===i?U.send(JSON.stringify({...V,session_hash:k})):"complete"===i?X=o:"log"===i?r({type:"log",title:a.title,log:a.log,level:a.level,endpoint:Y,duration:a.duration,visible:a.visible,fn_index:F}):"generating"===i&&r({type:"status",time:new Date,...o,stage:null==o?void 0:o.stage,queue:!0,endpoint:Y,fn_index:F})}a&&(r({type:"data",time:new Date,data:K(a.data,W,S.components,"output",q.with_null_state),endpoint:Y,fn_index:F,event_data:n,trigger_id:s}),X&&(r({type:"status",time:new Date,...X,stage:null==o?void 0:o.stage,queue:!0,endpoint:Y,fn_index:F}),U.close()))},d(S.version||"2.0.0","3.6")<0&&addEventListener("open",(()=>U.send(JSON.stringify({hash:k}))))}else if("sse"==G){r({type:"status",stage:"pending",queue:!0,endpoint:Y,fn_index:F,time:new Date});var o=new URLSearchParams({fn_index:F.toString(),session_hash:k}).toString();let e=new URL(`${S.root}${z}/${h}?${te?te+"&":""}${o}`);if(this.jwt&&e.searchParams.set("__sign",this.jwt),B=this.stream(e),!B)return Promise.reject(new Error("Cannot connect to SSE endpoint: "+e.toString()));B.onmessage=async function(e){const t=JSON.parse(e.data),{type:i,status:o,data:a}=R(t,ee[F]);if("update"===i&&o&&!X)r({type:"status",endpoint:Y,fn_index:F,time:new Date,...o}),"error"===o.stage&&(null==B||B.close(),c());else if("data"===i){let[e,t]=await D(`${S.root}${z}/queue/data`,{...V,session_hash:k,event_id:Q});200!==t&&(r({type:"status",stage:"error",message:v,queue:!0,endpoint:Y,fn_index:F,time:new Date}),null==B||B.close(),c())}else"complete"===i?X=o:"log"===i?r({type:"log",title:a.title,log:a.log,level:a.level,endpoint:Y,duration:a.duration,visible:a.visible,fn_index:F}):"generating"!==i&&"streaming"!==i||r({type:"status",time:new Date,...o,stage:null==o?void 0:o.stage,queue:!0,endpoint:Y,fn_index:F});a&&(r({type:"data",time:new Date,data:K(a.data,W,S.components,"output",q.with_null_state),endpoint:Y,fn_index:F,event_data:n,trigger_id:s}),X&&(r({type:"status",time:new Date,...X,stage:null==o?void 0:o.stage,queue:!0,endpoint:Y,fn_index:F}),null==B||B.close(),c()))}}else if("sse_v1"==G||"sse_v2"==G||"sse_v2.1"==G||"sse_v3"==G){r({type:"status",stage:"pending",queue:!0,endpoint:Y,fn_index:F,time:new Date});let e="";"undefined"!==typeof window&&"undefined"!==typeof document&&(e=null==(t=null==window?void 0:window.location)?void 0:t.hostname);let n="dev.spaces.huggingface.tech";const s=e.includes(".dev.")?`https://moon-${e.split(".")[1]}.${n}`:"https://huggingface.co",i="undefined"!==typeof window&&"undefined"!==typeof document&&window.parent!=window&&window.supports_zerogpu_headers?function(e,t){return new Promise(((n,s)=>{const i=new MessageChannel;i.port1.onmessage=e=>{let{data:t}=e;i.port1.close(),n(t)},window.parent.postMessage(e,t,[i.port2])}))}("zerogpu-headers",s):Promise.resolve(null);i.then((e=>D(`${S.root}${z}/${f}?${te}`,{...V,session_hash:k},e))).then((async e=>{let[t,n]=e;if(503===n)r({type:"status",stage:"error",message:y,queue:!0,endpoint:Y,fn_index:F,time:new Date});else if(200!==n)r({type:"status",stage:"error",message:v,queue:!0,endpoint:Y,fn_index:F,time:new Date});else{Q=t.event_id,H=Q;let e=async function(e){try{const{type:t,status:n,data:s,original_msg:i}=R(e,ee[F]);if("heartbeat"==t)return;if("update"===t&&n&&!X)r({type:"status",endpoint:Y,fn_index:F,time:new Date,original_msg:i,...n});else if("complete"===t)X=n;else if("unexpected_error"==t)console.error("Unexpected error",null==n?void 0:n.message),r({type:"status",stage:"error",message:(null==n?void 0:n.message)||"An Unexpected Error Occurred!",queue:!0,endpoint:Y,fn_index:F,time:new Date});else{if("log"===t)return void r({type:"log",title:s.title,log:s.log,level:s.level,endpoint:Y,duration:s.duration,visible:s.visible,fn_index:F});"generating"!==t&&"streaming"!==t||(r({type:"status",time:new Date,...n,stage:null==n?void 0:n.stage,queue:!0,endpoint:Y,fn_index:F}),s&&"stream"!==W.connection&&["sse_v2","sse_v2.1","sse_v3"].includes(G)&&fe(P,Q,s))}s&&(r({type:"data",time:new Date,data:K(s.data,W,S.components,"output",q.with_null_state),endpoint:Y,fn_index:F}),s.render_config&&await oe(s.render_config),X&&(r({type:"status",time:new Date,...X,stage:null==n?void 0:n.stage,queue:!0,endpoint:Y,fn_index:F}),c())),"complete"!==(null==n?void 0:n.stage)&&"error"!==(null==n?void 0:n.stage)||(A[Q]&&delete A[Q],Q in P&&delete P[Q])}catch(t){console.error("Unexpected client exception",t),r({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:Y,fn_index:F,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(G)&&(he(C,I.abort_controller),C.open=!1,c())}};Q in O&&(O[Q].forEach((t=>e(t))),delete O[Q]),A[Q]=e,j.add(Q),C.open||await this.open_stream()}}))}}));let ae=!1;const re=[],ce=[],le={[Symbol.asyncIterator]:()=>le,next:_,throw:async e=>(u(e),_()),return:async()=>(c(),_()),cancel:se,event_id:Z};return le}catch(a){throw console.error("Submit function encountered an error:",a),a}}s=new WeakMap;class me{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};var n;r(this,"app_reference"),r(this,"options"),r(this,"deep_link",null),r(this,"config"),r(this,"api_prefix",""),r(this,"api_info"),r(this,"api_map",{}),r(this,"session_hash",Math.random().toString(36).substring(2)),r(this,"jwt",!1),r(this,"last_status",{}),r(this,"cookies",null),r(this,"stream_status",{open:!1}),r(this,"closed",!1),r(this,"pending_stream_messages",{}),r(this,"pending_diff_streams",{}),r(this,"event_callbacks",{}),r(this,"unclosed_events",new Set),r(this,"heartbeat_event",null),r(this,"abort_controller",null),r(this,"stream_instance",null),r(this,"current_payload"),r(this,"ws_map",{}),r(this,"view_api"),r(this,"upload_files"),r(this,"upload"),r(this,"handle_blob"),r(this,"post_data"),r(this,"submit"),r(this,"predict"),r(this,"open_stream"),r(this,"resolve_config"),r(this,"resolve_cookies"),this.app_reference=e,this.deep_link=(null==(n=t.query_params)?void 0:n.deep_link)||null,t.events||(t.events=["data"]),this.options=t,this.current_payload={},this.view_api=U.bind(this),this.upload_files=B.bind(this),this.handle_blob=V.bind(this),this.post_data=ee.bind(this),this.submit=ge.bind(this),this.predict=te.bind(this),this.open_stream=pe.bind(this),this.resolve_config=T.bind(this),this.resolve_cookies=C.bind(this),this.upload=F.bind(this),this.fetch=this.fetch.bind(this),this.handle_space_success=this.handle_space_success.bind(this),this.stream=this.stream.bind(this)}get_url_config(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.config)throw new Error(b);null===e&&(e=window.location.href);const t=e=>e.replace(/^\/+|\/+$/g,"");let n,s=t(new URL(this.config.root).pathname),i=t(new URL(e).pathname);return n=i.startsWith(s)?t(i.substring(s.length)):"",this.get_page_config(n)}get_page_config(e){if(!this.config)throw new Error(b);let t=this.config;return e in t.page||(e=""),{...t,current_page:e,layout:t.page[e].layout,components:t.components.filter((n=>t.page[e].components.includes(n.id))),dependencies:this.config.dependencies.filter((n=>t.page[e].dependencies.includes(n.id)))}}fetch(e,t){const n=new Headers((null==t?void 0:t.headers)||{});if(this&&this.cookies&&n.append("Cookie",this.cookies),this&&this.options.headers)for(const s in this.options.headers)n.append(s,this.options.headers[s]);return fetch(e,{...t,headers:n})}stream(e){const t=new Headers;if(this&&this.cookies&&t.append("Cookie",this.cookies),this&&this.options.headers)for(const n in this.options.headers)t.append(n,this.options.headers[n]);return this.abort_controller=new AbortController,this.stream_instance=_e(e.toString(),{credentials:"include",headers:t,signal:this.abort_controller.signal}),this.stream_instance}async init(){var e;if(("undefined"===typeof window||!("WebSocket"in window))&&!global.WebSocket){const e=await Promise.all([n.e(152),n.e(995)]).then(n.bind(n,8152));global.WebSocket=e.WebSocket}this.options.auth&&await this.resolve_cookies(),await this._resolve_config().then((e=>{let{config:t}=e;return this._resolve_hearbeat(t)})),this.api_info=await this.view_api(),this.api_map=function(e){let t={};return e.forEach((e=>{let{api_name:n,id:s}=e;n&&(t[n]=s)})),t}((null==(e=this.config)?void 0:e.dependencies)||[])}async _resolve_hearbeat(e){if(e&&(this.config=e,this.api_prefix=e.api_prefix||"",this.config&&this.config.connect_heartbeat&&this.config.space_id&&this.options.hf_token&&(this.jwt=await x(this.config.space_id,this.options.hf_token,this.cookies))),e.space_id&&this.options.hf_token&&(this.jwt=await x(e.space_id,this.options.hf_token)),this.config&&this.config.connect_heartbeat){const e=new URL(`${this.config.root}${this.api_prefix}/heartbeat/${this.session_hash}`);this.jwt&&e.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(e))}}static async connect(e){const t=new this(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]});return await t.init(),t}close(){this.closed=!0,he(this.stream_status,this.abort_controller)}set_current_payload(e){this.current_payload=e}static async duplicate(e){return re(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]})}async _resolve_config(){const{http_protocol:e,host:t,space_id:n}=await N(this.app_reference,this.options.hf_token),{status_callback:s}=this.options;let i;n&&s&&await se(n,s);try{let n=`${e}//${t}`;if(i=await this.resolve_config(n),!i)throw new Error(b);return this.config_success(i)}catch(o){if(!n||!s)throw s&&s({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(o);ne(n,j.test(n)?"space_name":"subdomain",this.handle_space_success)}}async config_success(e){if(this.config=e,this.api_prefix=e.api_prefix||"","undefined"!==typeof window&&"undefined"!==typeof document&&"https:"===window.location.protocol&&(this.config.root=this.config.root.replace("http://","https://")),this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(t){console.error("Could not get API info. "+t.message)}return this.prepare_return_obj()}async handle_space_success(e){var t;if(!this)throw new Error(b);const{status_callback:n}=this.options;if(n&&n(e),"running"===e.status)try{if(this.config=await this._resolve_config(),this.api_prefix=(null==(t=null==this?void 0:this.config)?void 0:t.api_prefix)||"",!this.config)throw new Error(b);return await this.config_success(this.config)}catch(s){throw n&&n({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),s}}async component_server(e,t,n){var s;if(!this.config)throw new Error(b);const i={},{hf_token:o}=this.options,{session_hash:a}=this;let r;o&&(i.Authorization=`Bearer ${this.options.hf_token}`);let c,l=this.config.components.find((t=>t.id===e));if(r=(null==(s=null==l?void 0:l.props)?void 0:s.root_url)?l.props.root_url:this.config.root,"binary"in n){c=new FormData;for(const e in n.data)"binary"!==e&&c.append(e,n.data[e]);c.set("component_id",e.toString()),c.set("fn_name",t),c.set("session_hash",a)}else c=JSON.stringify({data:n,component_id:e,fn_name:t,session_hash:a}),i["Content-Type"]="application/json";o&&(i.Authorization=`Bearer ${o}`);try{const e=await this.fetch(`${r}${this.api_prefix}/component_server/`,{method:"POST",body:c,headers:i,credentials:"include"});if(!e.ok)throw new Error("Could not connect to component server: "+e.statusText);return await e.json()}catch(u){console.warn(u)}}set_cookies(e){this.cookies=A(e).join("; ")}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}async connect_ws(e){return new Promise(((t,n)=>{let s;try{s=new WebSocket(e)}catch(i){return void(this.ws_map[e]="failed")}s.onopen=()=>{t()},s.onerror=n=>{console.error("WebSocket error:",n),this.close_ws(e),this.ws_map[e]="failed",t()},s.onclose=()=>{delete this.ws_map[e],this.ws_map[e]="failed"},s.onmessage=e=>{},this.ws_map[e]=s}))}async send_ws_message(e,t){e in this.ws_map||await this.connect_ws(e);const n=this.ws_map[e];n instanceof WebSocket?n.send(JSON.stringify(t)):this.post_data(e,t)}async close_ws(e){if(e in this.ws_map){const t=this.ws_map[e];t instanceof WebSocket&&(t.close(),delete this.ws_map[e])}}}async function we(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return await me.connect(e,t)}async function ye(e,t){return await me.duplicate(e,t)}}}]);
//# sourceMappingURL=528.df53f183.chunk.js.map